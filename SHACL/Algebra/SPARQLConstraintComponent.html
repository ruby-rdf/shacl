<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>
  Class: SHACL::Algebra::SPARQLConstraintComponent
  
    &mdash; SHACL: Shapes Constraint Language (SHACL) for Ruby
  
</title>

  <link rel="stylesheet" href="../../css/style.css" type="text/css" />

  <link rel="stylesheet" href="../../css/common.css" type="text/css" />

<script type="text/javascript">
  pathId = "SHACL::Algebra::SPARQLConstraintComponent";
  relpath = '../../';
</script>


  <script type="text/javascript" charset="utf-8" src="../../js/jquery.js"></script>

  <script type="text/javascript" charset="utf-8" src="../../js/app.js"></script>


  </head>
  <body>
    <div class="nav_wrap">
      <iframe id="nav" src="../../class_list.html?1"></iframe>
      <div id="resizer"></div>
    </div>

    <div id="main" tabindex="-1">
      <div id="header">
        <div id="menu">
  
    <a href="../../_index.html">Index (S)</a> &raquo;
    <span class='title'><span class='object_link'><a href="../../SHACL.html" title="SHACL (module)">SHACL</a></span></span> &raquo; <span class='title'><span class='object_link'><a href="../Algebra.html" title="SHACL::Algebra (module)">Algebra</a></span></span>
     &raquo; 
    <span class="title">SPARQLConstraintComponent</span>
  
</div>

        <div id="search">
  
    <a class="full_list_link" id="class_list_link"
        href="../../class_list.html">

        <svg width="24" height="24">
          <rect x="0" y="4" width="24" height="4" rx="1" ry="1"></rect>
          <rect x="0" y="12" width="24" height="4" rx="1" ry="1"></rect>
          <rect x="0" y="20" width="24" height="4" rx="1" ry="1"></rect>
        </svg>
    </a>
  
</div>
        <div class="clear"></div>
      </div>

      <div id="content"><h1>Class: SHACL::Algebra::SPARQLConstraintComponent
  
  
  
</h1>
<div class="box_info">
  
  <dl>
    <dt>Inherits:</dt>
    <dd>
      <span class="inheritName"><span class='object_link'><a href="ConstraintComponent.html" title="SHACL::Algebra::ConstraintComponent (class)">ConstraintComponent</a></span></span>
      
        <ul class="fullTree">
          <li>Object</li>
          
            <li class="next">SPARQL::Algebra::Operator</li>
          
            <li class="next"><span class='object_link'><a href="Operator.html" title="SHACL::Algebra::Operator (class)">Operator</a></span></li>
          
            <li class="next"><span class='object_link'><a href="ConstraintComponent.html" title="SHACL::Algebra::ConstraintComponent (class)">ConstraintComponent</a></span></li>
          
            <li class="next">SHACL::Algebra::SPARQLConstraintComponent</li>
          
        </ul>
        <a href="#" class="inheritanceTree">show all</a>
      
    </dd>
  </dl>
  

  
  
  
  
  

  

  
  <dl>
    <dt>Defined in:</dt>
    <dd>lib/shacl/algebra/sparql_constraint.rb</dd>
  </dl>
  
</div>


  
    <h2>
      Constant Summary
      <small><a href="#" class="constants_summary_toggle">collapse</a></small>
    </h2>

    <dl class="constants">
      
        <dt id="NAME-constant" class="">NAME =
          
        </dt>
        <dd><pre class="code"><span class='symbol'>:sparql</span></pre></dd>
      
        <dt id="UNSUPPORTED_SPARQL_OPERATORS-constant" class="">UNSUPPORTED_SPARQL_OPERATORS =
          <div class="docstring">
  <div class="discussion">
    
<p>SPARQL Operators prohibited from being used in expression.</p>


  </div>
</div>
<div class="tags">
  

</div>
        </dt>
        <dd><pre class="code"><span class='lbracket'>[</span>
  <span class='const'>SPARQL</span><span class='op'>::</span><span class='const'>Algebra</span><span class='op'>::</span><span class='const'>Operator</span><span class='op'>::</span><span class='const'>Minus</span><span class='comma'>,</span>
  <span class='const'>SPARQL</span><span class='op'>::</span><span class='const'>Algebra</span><span class='op'>::</span><span class='const'>Operator</span><span class='op'>::</span><span class='const'>Service</span><span class='comma'>,</span>
  <span class='const'>SPARQL</span><span class='op'>::</span><span class='const'>Algebra</span><span class='op'>::</span><span class='const'>Operator</span><span class='op'>::</span><span class='const'>Table</span><span class='comma'>,</span>
<span class='rbracket'>]</span></pre></dd>
      
        <dt id="PRE_BOUND-constant" class="">PRE_BOUND =
          <div class="docstring">
  <div class="discussion">
    
<p>Potentially pre-bound variables.</p>


  </div>
</div>
<div class="tags">
  

</div>
        </dt>
        <dd><pre class="code"><span class='qsymbols_beg'>%i(</span><span class='tstring_content'>currentShape</span><span class='words_sep'> </span><span class='tstring_content'>shapesGraph</span><span class='words_sep'> </span><span class='tstring_content'>PATH</span><span class='words_sep'> </span><span class='tstring_content'>this</span><span class='words_sep'> </span><span class='tstring_content'>value</span><span class='tstring_end'>)</span></span></pre></dd>
      
        <dt id="BUILTIN_KEYS-constant" class="">BUILTIN_KEYS =
          <div class="docstring">
  <div class="discussion">
    
<p>All keys associated with shapes which are set in options</p>


  </div>
</div>
<div class="tags">
  
<p class="tag_title">Returns:</p>
<ul class="return">
  
    <li>
      
      
        <span class='type'>(<tt>Array&lt;Symbol&gt;</tt>)</span>
      
      
      
    </li>
  
</ul>

</div>
        </dt>
        <dd><pre class="code"><span class='qsymbols_beg'>%i(</span><span class='words_sep'>
  </span><span class='tstring_content'>type</span><span class='words_sep'> </span><span class='tstring_content'>label</span><span class='words_sep'> </span><span class='tstring_content'>name</span><span class='words_sep'> </span><span class='tstring_content'>comment</span><span class='words_sep'> </span><span class='tstring_content'>description</span><span class='words_sep'> </span><span class='tstring_content'>deactivated</span><span class='words_sep'> </span><span class='tstring_content'>severity</span><span class='words_sep'>
  </span><span class='tstring_content'>message</span><span class='words_sep'> </span><span class='tstring_content'>path</span><span class='words_sep'>
  </span><span class='tstring_content'>ask</span><span class='words_sep'> </span><span class='tstring_content'>select</span><span class='words_sep'>
  </span><span class='tstring_content'>declare</span><span class='words_sep'> </span><span class='tstring_content'>namespace</span><span class='words_sep'> </span><span class='tstring_content'>prefix</span><span class='words_sep'> </span><span class='tstring_content'>prefixes</span><span class='words_sep'> </span><span class='tstring_content'>select</span><span class='words_sep'> </span><span class='tstring_content'>ask</span><span class='words_sep'>
</span><span class='tstring_end'>)</span></span><span class='period'>.</span><span class='id identifier rubyid_freeze'>freeze</span></pre></dd>
      
    </dl>
  



  
  
  <h3 class="inherited">Constants inherited
     from <span class='object_link'><a href="Operator.html" title="SHACL::Algebra::Operator (class)">Operator</a></span></h3>
  <p class="inherited"><span class='object_link'><a href="Operator.html#COMPONENT_PARAMS-constant" title="SHACL::Algebra::Operator::COMPONENT_PARAMS (constant)">Operator::COMPONENT_PARAMS</a></span>, <span class='object_link'><a href="Operator.html#PARAMETERS-constant" title="SHACL::Algebra::Operator::PARAMETERS (constant)">Operator::PARAMETERS</a></span></p>




  <h2>Instance Attribute Summary</h2>
  
  <h3 class="inherited">Attributes inherited from <span class='object_link'><a href="Operator.html" title="SHACL::Algebra::Operator (class)">Operator</a></span></h3>
  <p class="inherited"><span class='object_link'><a href="Operator.html#graph-instance_method" title="SHACL::Algebra::Operator#graph (method)">#graph</a></span>, <span class='object_link'><a href="Operator.html#options-instance_method" title="SHACL::Algebra::Operator#options (method)">#options</a></span>, <span class='object_link'><a href="Operator.html#shapes_graph-instance_method" title="SHACL::Algebra::Operator#shapes_graph (method)">#shapes_graph</a></span></p>


  
    <h2>
      Class Method Summary
      <small><a href="#" class="summary_toggle">collapse</a></small>
    </h2>

    <ul class="summary">
      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#from_json-class_method" title="from_json (class method)">.<strong>from_json</strong>(operator, **options)  &#x21d2; Operator </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>Creates an operator instance from a parsed SHACL representation.</p>
</div></span>
  
</li>

      
    </ul>
  
    <h2>
      Instance Method Summary
      <small><a href="#" class="summary_toggle">collapse</a></small>
    </h2>

    <ul class="summary">
      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#conforms-instance_method" title="#conforms (instance method)">#<strong>conforms</strong>(node, path: nil, depth: 0, **options)  &#x21d2; Array&lt;SHACL::ValidationResult&gt; </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>Validates the specified <code>property</code> within <code>graph</code>, a list of <span class='object_link'><a href="../ValidationResult.html" title="SHACL::ValidationResult (class)">ValidationResult</a></span>.</p>
</div></span>
  
</li>

      
    </ul>
  


  
  
  
  
  
  
  
  
  
  
  
  
  
  
  <h3 class="inherited">Methods inherited from <span class='object_link'><a href="Operator.html" title="SHACL::Algebra::Operator (class)">Operator</a></span></h3>
  <p class="inherited"><span class='object_link'><a href="Operator.html#apply_op-class_method" title="SHACL::Algebra::Operator.apply_op (method)">apply_op</a></span>, <span class='object_link'><a href="Operator.html#comment-instance_method" title="SHACL::Algebra::Operator#comment (method)">#comment</a></span>, <span class='object_link'><a href="Operator.html#deactivated%3F-instance_method" title="SHACL::Algebra::Operator#deactivated? (method)">#deactivated?</a></span>, <span class='object_link'><a href="Operator.html#from_expanded_value-class_method" title="SHACL::Algebra::Operator.from_expanded_value (method)">from_expanded_value</a></span>, <span class='object_link'><a href="Operator.html#id-instance_method" title="SHACL::Algebra::Operator#id (method)">#id</a></span>, <span class='object_link'><a href="Operator.html#iri-class_method" title="SHACL::Algebra::Operator.iri (method)">iri</a></span>, <span class='object_link'><a href="Operator.html#iri-instance_method" title="SHACL::Algebra::Operator#iri (method)">#iri</a></span>, <span class='object_link'><a href="Operator.html#label-instance_method" title="SHACL::Algebra::Operator#label (method)">#label</a></span>, <span class='object_link'><a href="Operator.html#not_satisfied-instance_method" title="SHACL::Algebra::Operator#not_satisfied (method)">#not_satisfied</a></span>, <span class='object_link'><a href="Operator.html#parse_path-class_method" title="SHACL::Algebra::Operator.parse_path (method)">parse_path</a></span>, <span class='object_link'><a href="Operator.html#satisfy-instance_method" title="SHACL::Algebra::Operator#satisfy (method)">#satisfy</a></span>, <span class='object_link'><a href="Operator.html#to_rdf-class_method" title="SHACL::Algebra::Operator.to_rdf (method)">to_rdf</a></span>, <span class='object_link'><a href="Operator.html#to_sxp_bin-instance_method" title="SHACL::Algebra::Operator#to_sxp_bin (method)">#to_sxp_bin</a></span>, <span class='object_link'><a href="Operator.html#type-instance_method" title="SHACL::Algebra::Operator#type (method)">#type</a></span></p>

  
  
  

  <div id="class_method_details" class="method_details_list">
    <h2>Class Method Details</h2>

    
      <div class="method_details first">
  <h3 class="signature first" id="from_json-class_method">
  
    .<strong>from_json</strong>(operator, **options)  &#x21d2; <tt><span class='object_link'><a href="Operator.html" title="SHACL::Algebra::Operator (class)">Operator</a></span></tt> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>Creates an operator instance from a parsed SHACL representation.</p>

<p>Special case for SPARQLComponenet due to general recursion.</p>


  </div>
</div>
<div class="tags">
  <p class="tag_title">Parameters:</p>
<ul class="param">
  
    <li>
      
        <span class='name'>operator</span>
      
      
        <span class='type'>(<tt>Hash</tt>)</span>
      
      
      
    </li>
  
    <li>
      
        <span class='name'>options</span>
      
      
        <span class='type'>(<tt>Hash</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'>
<p>({})</p>
</div>
      
    </li>
  
</ul>

  
    
    
    
    
    <p class="tag_title">Options Hash (<tt>**options</tt>):</p>
    <ul class="option">
      
        <li>
          <span class="name">:prefixes</span>
          <span class="type">(<tt>Hash{String =&gt; RDF::URI}</tt>)</span>
          <span class="default">
            
          </span>
          
        </li>
      
    </ul>
  

<p class="tag_title">Returns:</p>
<ul class="return">
  
    <li>
      
      
        <span class='type'>(<tt><span class='object_link'><a href="Operator.html" title="SHACL::Algebra::Operator (class)">Operator</a></span></tt>)</span>
      
      
      
    </li>
  
</ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


92
93
94
95
96
97
98
99
100
101
102
103
104
105
106
107
108
109
110
111
112
113
114
115
116
117
118
119
120
121
122
123
124
125
126
127
128
129
130
131
132
133
134
135
136
137
138
139</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/shacl/algebra/sparql_constraint.rb', line 92</span>

<span class='kw'>def</span> <span class='id identifier rubyid_from_json'>from_json</span><span class='lparen'>(</span><span class='id identifier rubyid_operator'>operator</span><span class='comma'>,</span> <span class='op'>**</span><span class='id identifier rubyid_options'>options</span><span class='rparen'>)</span>
  <span class='id identifier rubyid_prefixes'>prefixes</span><span class='comma'>,</span> <span class='id identifier rubyid_query'>query</span> <span class='op'>=</span> <span class='lbracket'>[</span><span class='rbracket'>]</span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_end'>&quot;</span></span>
  <span class='id identifier rubyid_operands'>operands</span> <span class='op'>=</span> <span class='lbracket'>[</span><span class='rbracket'>]</span>
  <span class='id identifier rubyid_node_opts'>node_opts</span> <span class='op'>=</span> <span class='id identifier rubyid_options'>options</span><span class='period'>.</span><span class='id identifier rubyid_dup'>dup</span>
  <span class='id identifier rubyid_operator'>operator</span><span class='period'>.</span><span class='id identifier rubyid_each'>each</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_k'>k</span><span class='comma'>,</span> <span class='id identifier rubyid_v'>v</span><span class='op'>|</span>
    <span class='kw'>next</span> <span class='kw'>if</span> <span class='id identifier rubyid_v'>v</span><span class='period'>.</span><span class='id identifier rubyid_nil?'>nil?</span>
    <span class='kw'>case</span> <span class='id identifier rubyid_k'>k</span>
    <span class='comment'># List properties
</span>    <span class='kw'>when</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>path</span><span class='tstring_end'>&#39;</span></span>               <span class='kw'>then</span> <span class='id identifier rubyid_node_opts'>node_opts</span><span class='lbracket'>[</span><span class='symbol'>:path</span><span class='rbracket'>]</span> <span class='op'>=</span> <span class='id identifier rubyid_parse_path'>parse_path</span><span class='lparen'>(</span><span class='id identifier rubyid_v'>v</span><span class='comma'>,</span> <span class='op'>**</span><span class='id identifier rubyid_options'>options</span><span class='rparen'>)</span>
    <span class='kw'>when</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>prefixes</span><span class='tstring_end'>&#39;</span></span>
      <span class='id identifier rubyid_prefixes'>prefixes</span> <span class='op'>=</span> <span class='id identifier rubyid_extract_prefixes'>extract_prefixes</span><span class='lparen'>(</span><span class='id identifier rubyid_v'>v</span><span class='rparen'>)</span>
    <span class='kw'>when</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>severity</span><span class='tstring_end'>&#39;</span></span>           <span class='kw'>then</span> <span class='id identifier rubyid_node_opts'>node_opts</span><span class='lbracket'>[</span><span class='symbol'>:severity</span><span class='rbracket'>]</span> <span class='op'>=</span> <span class='id identifier rubyid_iri'>iri</span><span class='lparen'>(</span><span class='id identifier rubyid_v'>v</span><span class='comma'>,</span> <span class='op'>**</span><span class='id identifier rubyid_options'>options</span><span class='rparen'>)</span>
    <span class='kw'>when</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>type</span><span class='tstring_end'>&#39;</span></span>               <span class='kw'>then</span> <span class='id identifier rubyid_node_opts'>node_opts</span><span class='lbracket'>[</span><span class='symbol'>:type</span><span class='rbracket'>]</span> <span class='op'>=</span> <span class='id identifier rubyid_as_array'>as_array</span><span class='lparen'>(</span><span class='id identifier rubyid_v'>v</span><span class='rparen'>)</span><span class='period'>.</span><span class='id identifier rubyid_map'>map</span> <span class='lbrace'>{</span><span class='op'>|</span><span class='id identifier rubyid_vv'>vv</span><span class='op'>|</span> <span class='id identifier rubyid_iri'>iri</span><span class='lparen'>(</span><span class='id identifier rubyid_vv'>vv</span><span class='comma'>,</span> <span class='op'>**</span><span class='id identifier rubyid_options'>options</span><span class='rparen'>)</span><span class='rbrace'>}</span> <span class='kw'>if</span> <span class='id identifier rubyid_v'>v</span>
    <span class='kw'>else</span>
      <span class='id identifier rubyid_node_opts'>node_opts</span><span class='lbracket'>[</span><span class='id identifier rubyid_k'>k</span><span class='period'>.</span><span class='id identifier rubyid_to_sym'>to_sym</span><span class='rbracket'>]</span> <span class='op'>=</span> <span class='id identifier rubyid_to_rdf'>to_rdf</span><span class='lparen'>(</span><span class='id identifier rubyid_k'>k</span><span class='period'>.</span><span class='id identifier rubyid_to_sym'>to_sym</span><span class='comma'>,</span> <span class='id identifier rubyid_v'>v</span><span class='comma'>,</span> <span class='op'>**</span><span class='id identifier rubyid_options'>options</span><span class='rparen'>)</span> <span class='kw'>if</span> <span class='const'><span class='object_link'><a href="#BUILTIN_KEYS-constant" title="SHACL::Algebra::SPARQLConstraintComponent::BUILTIN_KEYS (constant)">BUILTIN_KEYS</a></span></span><span class='period'>.</span><span class='id identifier rubyid_include?'>include?</span><span class='lparen'>(</span><span class='id identifier rubyid_k'>k</span><span class='period'>.</span><span class='id identifier rubyid_to_sym'>to_sym</span><span class='rparen'>)</span>
    <span class='kw'>end</span>
  <span class='kw'>end</span>

  <span class='id identifier rubyid_query_string'>query_string</span> <span class='op'>=</span> <span class='id identifier rubyid_prefixes'>prefixes</span><span class='period'>.</span><span class='id identifier rubyid_join'>join</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>\n</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span> <span class='op'>+</span> <span class='id identifier rubyid_node_opts'>node_opts</span><span class='lbracket'>[</span><span class='symbol'>:select</span><span class='rbracket'>]</span> <span class='op'>||</span> <span class='id identifier rubyid_node_opts'>node_opts</span><span class='lbracket'>[</span><span class='symbol'>:ask</span><span class='rbracket'>]</span>
  <span class='id identifier rubyid_query'>query</span> <span class='op'>=</span> <span class='const'>SPARQL</span><span class='period'>.</span><span class='id identifier rubyid_parse'>parse</span><span class='lparen'>(</span><span class='id identifier rubyid_query_string'>query_string</span><span class='rparen'>)</span>

  <span class='id identifier rubyid_options'>options</span><span class='lbracket'>[</span><span class='symbol'>:logger</span><span class='rbracket'>]</span><span class='period'>.</span><span class='id identifier rubyid_info'>info</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='embexpr_beg'>#{</span><span class='const'><span class='object_link'><a href="#NAME-constant" title="SHACL::Algebra::SPARQLConstraintComponent::NAME (constant)">NAME</a></span></span><span class='embexpr_end'>}</span><span class='tstring_content'> SXP: </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_query'>query</span><span class='period'>.</span><span class='id identifier rubyid_to_sxp'>to_sxp</span><span class='embexpr_end'>}</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span> <span class='kw'>if</span> <span class='id identifier rubyid_options'>options</span><span class='lbracket'>[</span><span class='symbol'>:logger</span><span class='rbracket'>]</span>

  <span class='comment'># Queries have restrictions
</span>  <span class='id identifier rubyid_operators'>operators</span> <span class='op'>=</span> <span class='id identifier rubyid_query'>query</span><span class='period'>.</span><span class='id identifier rubyid_descendants'>descendants</span><span class='period'>.</span><span class='id identifier rubyid_to_a'>to_a</span><span class='period'>.</span><span class='id identifier rubyid_unshift'>unshift</span><span class='lparen'>(</span><span class='id identifier rubyid_query'>query</span><span class='rparen'>)</span>

  <span class='kw'>if</span> <span class='id identifier rubyid_node_opts'>node_opts</span><span class='lbracket'>[</span><span class='symbol'>:ask</span><span class='rbracket'>]</span> <span class='op'>&amp;&amp;</span> <span class='op'>!</span><span class='id identifier rubyid_operators'>operators</span><span class='period'>.</span><span class='id identifier rubyid_any?'>any?</span> <span class='lbrace'>{</span><span class='op'>|</span><span class='id identifier rubyid_op'>op</span><span class='op'>|</span> <span class='id identifier rubyid_op'>op</span><span class='period'>.</span><span class='id identifier rubyid_is_a?'>is_a?</span><span class='lparen'>(</span><span class='const'>SPARQL</span><span class='op'>::</span><span class='const'>Algebra</span><span class='op'>::</span><span class='const'>Operator</span><span class='op'>::</span><span class='const'>Ask</span><span class='rparen'>)</span><span class='rbrace'>}</span>
    <span class='id identifier rubyid_raise'>raise</span> <span class='const'><span class='object_link'><a href="../../SHACL.html" title="SHACL (module)">SHACL</a></span></span><span class='op'>::</span><span class='const'><span class='object_link'><a href="../Error.html" title="SHACL::Error (class)">Error</a></span></span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Ask query must have ask operator</span><span class='tstring_end'>&quot;</span></span>
  <span class='kw'>elsif</span> <span class='id identifier rubyid_node_opts'>node_opts</span><span class='lbracket'>[</span><span class='symbol'>:select</span><span class='rbracket'>]</span> <span class='op'>&amp;&amp;</span> <span class='op'>!</span><span class='id identifier rubyid_operators'>operators</span><span class='period'>.</span><span class='id identifier rubyid_any?'>any?</span> <span class='lbrace'>{</span><span class='op'>|</span><span class='id identifier rubyid_op'>op</span><span class='op'>|</span> <span class='id identifier rubyid_op'>op</span><span class='period'>.</span><span class='id identifier rubyid_is_a?'>is_a?</span><span class='lparen'>(</span><span class='const'>SPARQL</span><span class='op'>::</span><span class='const'>Algebra</span><span class='op'>::</span><span class='const'>Operator</span><span class='op'>::</span><span class='const'>Project</span><span class='rparen'>)</span><span class='rbrace'>}</span>
    <span class='id identifier rubyid_raise'>raise</span> <span class='const'><span class='object_link'><a href="../../SHACL.html" title="SHACL (module)">SHACL</a></span></span><span class='op'>::</span><span class='const'><span class='object_link'><a href="../Error.html" title="SHACL::Error (class)">Error</a></span></span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Select query must have project operator</span><span class='tstring_end'>&quot;</span></span>
  <span class='kw'>end</span>

  <span class='id identifier rubyid_uh_oh'>uh_oh</span> <span class='op'>=</span> <span class='lparen'>(</span><span class='id identifier rubyid_operators'>operators</span><span class='period'>.</span><span class='id identifier rubyid_map'>map</span><span class='lparen'>(</span><span class='op'>&amp;</span><span class='symbol'>:class</span><span class='rparen'>)</span> <span class='op'>&amp;</span> <span class='const'><span class='object_link'><a href="#UNSUPPORTED_SPARQL_OPERATORS-constant" title="SHACL::Algebra::SPARQLConstraintComponent::UNSUPPORTED_SPARQL_OPERATORS (constant)">UNSUPPORTED_SPARQL_OPERATORS</a></span></span><span class='rparen'>)</span><span class='period'>.</span><span class='id identifier rubyid_map'>map</span> <span class='lbrace'>{</span><span class='op'>|</span><span class='id identifier rubyid_c'>c</span><span class='op'>|</span> <span class='id identifier rubyid_c'>c</span><span class='period'>.</span><span class='id identifier rubyid_const_get'>const_get</span><span class='lparen'>(</span><span class='symbol'>:NAME</span><span class='rparen'>)</span><span class='rbrace'>}</span>

  <span class='kw'>unless</span> <span class='id identifier rubyid_uh_oh'>uh_oh</span><span class='period'>.</span><span class='id identifier rubyid_empty?'>empty?</span>
    <span class='id identifier rubyid_raise'>raise</span> <span class='const'><span class='object_link'><a href="../../SHACL.html" title="SHACL (module)">SHACL</a></span></span><span class='op'>::</span><span class='const'><span class='object_link'><a href="../Error.html" title="SHACL::Error (class)">Error</a></span></span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Query must not include operators </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_uh_oh'>uh_oh</span><span class='period'>.</span><span class='id identifier rubyid_to_sxp'>to_sxp</span><span class='embexpr_end'>}</span><span class='tstring_content'>: </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_query_string'>query_string</span><span class='embexpr_end'>}</span><span class='tstring_end'>&quot;</span></span>
  <span class='kw'>end</span>

  <span class='comment'># Additionally, queries must not bind to special variables
</span>  <span class='id identifier rubyid_operators'>operators</span><span class='period'>.</span><span class='id identifier rubyid_select'>select</span> <span class='lbrace'>{</span><span class='op'>|</span><span class='id identifier rubyid_op'>op</span><span class='op'>|</span> <span class='id identifier rubyid_op'>op</span><span class='period'>.</span><span class='id identifier rubyid_is_a?'>is_a?</span><span class='lparen'>(</span><span class='const'>SPARQL</span><span class='op'>::</span><span class='const'>Algebra</span><span class='op'>::</span><span class='const'>Operator</span><span class='op'>::</span><span class='const'>Extend</span><span class='rparen'>)</span><span class='rbrace'>}</span><span class='period'>.</span><span class='id identifier rubyid_each'>each</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_extend'>extend</span><span class='op'>|</span>
    <span class='kw'>if</span> <span class='id identifier rubyid_extend'>extend</span><span class='period'>.</span><span class='id identifier rubyid_operands'>operands</span><span class='period'>.</span><span class='id identifier rubyid_first'>first</span><span class='period'>.</span><span class='id identifier rubyid_any?'>any?</span> <span class='lbrace'>{</span><span class='op'>|</span><span class='id identifier rubyid_v'>v</span><span class='comma'>,</span> <span class='id identifier rubyid_e'>e</span><span class='op'>|</span> <span class='const'><span class='object_link'><a href="#PRE_BOUND-constant" title="SHACL::Algebra::SPARQLConstraintComponent::PRE_BOUND (constant)">PRE_BOUND</a></span></span><span class='period'>.</span><span class='id identifier rubyid_include?'>include?</span><span class='lparen'>(</span><span class='id identifier rubyid_v'>v</span><span class='period'>.</span><span class='id identifier rubyid_to_sym'>to_sym</span><span class='rparen'>)</span><span class='rbrace'>}</span>
      <span class='id identifier rubyid_raise'>raise</span> <span class='const'><span class='object_link'><a href="../../SHACL.html" title="SHACL (module)">SHACL</a></span></span><span class='op'>::</span><span class='const'><span class='object_link'><a href="../Error.html" title="SHACL::Error (class)">Error</a></span></span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Query must not bind pre-bound variables: </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_query_string'>query_string</span><span class='embexpr_end'>}</span><span class='tstring_end'>&quot;</span></span>
    <span class='kw'>end</span>
  <span class='kw'>end</span>

  <span class='id identifier rubyid_operands'>operands</span> <span class='op'>&lt;&lt;</span> <span class='id identifier rubyid_query'>query</span>
  <span class='id identifier rubyid_new'>new</span><span class='lparen'>(</span><span class='op'>*</span><span class='id identifier rubyid_operands'>operands</span><span class='comma'>,</span> <span class='op'>**</span><span class='id identifier rubyid_node_opts'>node_opts</span><span class='rparen'>)</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
  </div>

  <div id="instance_method_details" class="method_details_list">
    <h2>Instance Method Details</h2>

    
      <div class="method_details first">
  <h3 class="signature first" id="conforms-instance_method">
  
    #<strong>conforms</strong>(node, path: nil, depth: 0, **options)  &#x21d2; <tt>Array&lt;<span class='object_link'><a href="../ValidationResult.html" title="SHACL::ValidationResult (class)">SHACL::ValidationResult</a></span>&gt;</tt> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>Validates the specified <code>property</code> within <code>graph</code>, a list of <span class='object_link'><a href="../ValidationResult.html" title="SHACL::ValidationResult (class)">ValidationResult</a></span>.</p>

<p>A property conforms the nodes found by evaluating it’s <code>path</code> all conform.</p>

<p>Last operand is the parsed query. Bound variables are added as a table entry joined to the query.</p>


  </div>
</div>
<div class="tags">
  <p class="tag_title">Parameters:</p>
<ul class="param">
  
    <li>
      
        <span class='name'>node</span>
      
      
        <span class='type'>(<tt>RDF::Term</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'>
<p>focus node</p>
</div>
      
    </li>
  
    <li>
      
        <span class='name'>path</span>
      
      
        <span class='type'>(<tt>RDF::URI</tt>, <tt>SPARQL::Algebra::Expression</tt>)</span>
      
      
        <em class="default">(defaults to: <tt>nil</tt>)</em>
      
      
        &mdash;
        <div class='inline'>
<p>the property path from the focus node to the value nodes.</p>
</div>
      
    </li>
  
    <li>
      
        <span class='name'>options</span>
      
      
        <span class='type'>(<tt>Hash{Symbol =&gt; Object}</tt>)</span>
      
      
      
    </li>
  
</ul>

<p class="tag_title">Returns:</p>
<ul class="return">
  
    <li>
      
      
        <span class='type'>(<tt>Array&lt;<span class='object_link'><a href="../ValidationResult.html" title="SHACL::ValidationResult (class)">SHACL::ValidationResult</a></span>&gt;</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'>
<p>Returns a validation result for each value node.</p>
</div>
      
    </li>
  
</ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
61
62
63
64
65
66
67
68
69</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/shacl/algebra/sparql_constraint.rb', line 31</span>

<span class='kw'>def</span> <span class='id identifier rubyid_conforms'>conforms</span><span class='lparen'>(</span><span class='id identifier rubyid_node'>node</span><span class='comma'>,</span> <span class='label'>path:</span> <span class='kw'>nil</span><span class='comma'>,</span> <span class='label'>depth:</span> <span class='int'>0</span><span class='comma'>,</span> <span class='op'>**</span><span class='id identifier rubyid_options'>options</span><span class='rparen'>)</span>
  <span class='kw'>return</span> <span class='lbracket'>[</span><span class='rbracket'>]</span> <span class='kw'>if</span> <span class='id identifier rubyid_deactivated?'>deactivated?</span>
  <span class='id identifier rubyid_options'>options</span> <span class='op'>=</span> <span class='lbrace'>{</span><span class='label'>severity:</span> <span class='const'>RDF</span><span class='op'>::</span><span class='const'>Vocab</span><span class='op'>::</span><span class='const'>SHACL</span><span class='period'>.</span><span class='const'>Violation</span><span class='rbrace'>}</span><span class='period'>.</span><span class='id identifier rubyid_merge'>merge</span><span class='lparen'>(</span><span class='id identifier rubyid_options'>options</span><span class='rparen'>)</span>
  <span class='id identifier rubyid_log_debug'>log_debug</span><span class='lparen'>(</span><span class='const'><span class='object_link'><a href="#NAME-constant" title="SHACL::Algebra::SPARQLConstraintComponent::NAME (constant)">NAME</a></span></span><span class='comma'>,</span> <span class='label'>depth:</span> <span class='id identifier rubyid_depth'>depth</span><span class='rparen'>)</span> <span class='lbrace'>{</span><span class='const'>SXP</span><span class='op'>::</span><span class='const'>Generator</span><span class='period'>.</span><span class='id identifier rubyid_string'>string</span><span class='lparen'>(</span><span class='lbrace'>{</span><span class='label'>node:</span> <span class='id identifier rubyid_node'>node</span><span class='rbrace'>}</span><span class='period'>.</span><span class='id identifier rubyid_to_sxp_bin'>to_sxp_bin</span><span class='rparen'>)</span><span class='rbrace'>}</span>

  <span class='comment'># Aggregate repo containing both data-graph (as the default) and shapes-graph, named by it&#39;s IRI
</span>  <span class='id identifier rubyid_aggregate'>aggregate</span> <span class='op'>=</span> <span class='const'>RDF</span><span class='op'>::</span><span class='const'>AggregateRepo</span><span class='period'>.</span><span class='id identifier rubyid_new'>new</span><span class='lparen'>(</span><span class='id identifier rubyid_graph'>graph</span><span class='period'>.</span><span class='id identifier rubyid_data'>data</span><span class='comma'>,</span> <span class='id identifier rubyid_shapes_graph'>shapes_graph</span><span class='period'>.</span><span class='id identifier rubyid_data'>data</span><span class='rparen'>)</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_ag'>ag</span><span class='op'>|</span>
    <span class='id identifier rubyid_ag'>ag</span><span class='period'>.</span><span class='id identifier rubyid_default'>default</span> <span class='kw'>false</span>
    <span class='id identifier rubyid_ag'>ag</span><span class='period'>.</span><span class='id identifier rubyid_named'>named</span> <span class='id identifier rubyid_shapes_graph'>shapes_graph</span><span class='period'>.</span><span class='id identifier rubyid_graph_name'>graph_name</span> <span class='kw'>if</span> <span class='id identifier rubyid_shapes_graph'>shapes_graph</span><span class='period'>.</span><span class='id identifier rubyid_graph_name'>graph_name</span>
  <span class='kw'>end</span>

  <span class='id identifier rubyid_aggregate'>aggregate</span><span class='period'>.</span><span class='id identifier rubyid_default_graph'>default_graph</span>
  <span class='id identifier rubyid_bindings'>bindings</span> <span class='op'>=</span> <span class='const'>RDF</span><span class='op'>::</span><span class='const'>Query</span><span class='op'>::</span><span class='const'>Solution</span><span class='period'>.</span><span class='id identifier rubyid_new'>new</span><span class='lparen'>(</span><span class='lbrace'>{</span>
    <span class='label'>currentShape:</span> <span class='id identifier rubyid_options'>options</span><span class='lbracket'>[</span><span class='symbol'>:shape</span><span class='rbracket'>]</span><span class='comma'>,</span>
    <span class='label'>shapesGraph:</span> <span class='id identifier rubyid_shapes_graph'>shapes_graph</span><span class='period'>.</span><span class='id identifier rubyid_graph_name'>graph_name</span><span class='comma'>,</span>
    <span class='label'>PATH:</span> <span class='id identifier rubyid_path'>path</span><span class='comma'>,</span>
    <span class='label'>this:</span> <span class='id identifier rubyid_node'>node</span><span class='comma'>,</span>
  <span class='rbrace'>}</span><span class='period'>.</span><span class='id identifier rubyid_compact'>compact</span><span class='rparen'>)</span>
  <span class='id identifier rubyid_solutions'>solutions</span> <span class='op'>=</span> <span class='id identifier rubyid_operands'>operands</span><span class='period'>.</span><span class='id identifier rubyid_last'>last</span><span class='period'>.</span><span class='id identifier rubyid_execute'>execute</span><span class='lparen'>(</span><span class='id identifier rubyid_aggregate'>aggregate</span><span class='comma'>,</span>
    <span class='label'>bindings:</span> <span class='id identifier rubyid_bindings'>bindings</span><span class='comma'>,</span>
    <span class='label'>depth:</span> <span class='id identifier rubyid_depth'>depth</span> <span class='op'>+</span> <span class='int'>1</span><span class='comma'>,</span>
    <span class='label'>logger:</span> <span class='lparen'>(</span><span class='ivar'>@logger</span> <span class='op'>||</span> <span class='ivar'>@options</span><span class='lbracket'>[</span><span class='symbol'>:logger</span><span class='rbracket'>]</span><span class='rparen'>)</span><span class='comma'>,</span>
    <span class='op'>**</span><span class='id identifier rubyid_options'>options</span><span class='rparen'>)</span>
  <span class='kw'>if</span> <span class='id identifier rubyid_solutions'>solutions</span><span class='period'>.</span><span class='id identifier rubyid_empty?'>empty?</span>
    <span class='id identifier rubyid_satisfy'>satisfy</span><span class='lparen'>(</span><span class='label'>focus:</span> <span class='id identifier rubyid_node'>node</span><span class='comma'>,</span> <span class='label'>path:</span> <span class='id identifier rubyid_path'>path</span><span class='comma'>,</span>
      <span class='label'>message:</span> <span class='ivar'>@options</span><span class='period'>.</span><span class='id identifier rubyid_fetch'>fetch</span><span class='lparen'>(</span><span class='symbol'>:message</span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>node conforms to SPARQL component</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span><span class='comma'>,</span>
      <span class='label'>component:</span> <span class='const'>RDF</span><span class='op'>::</span><span class='const'>Vocab</span><span class='op'>::</span><span class='const'>SHACL</span><span class='period'>.</span><span class='const'>SPARQLConstraintComponent</span><span class='comma'>,</span>
      <span class='label'>depth:</span> <span class='id identifier rubyid_depth'>depth</span><span class='comma'>,</span> <span class='op'>**</span><span class='id identifier rubyid_options'>options</span><span class='rparen'>)</span>
  <span class='kw'>else</span>
    <span class='id identifier rubyid_solutions'>solutions</span><span class='period'>.</span><span class='id identifier rubyid_map'>map</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_solution'>solution</span><span class='op'>|</span>
      <span class='id identifier rubyid_not_satisfied'>not_satisfied</span><span class='lparen'>(</span><span class='label'>focus:</span> <span class='id identifier rubyid_node'>node</span><span class='comma'>,</span> <span class='label'>path:</span> <span class='lparen'>(</span><span class='id identifier rubyid_path'>path</span> <span class='op'>||</span> <span class='id identifier rubyid_solution'>solution</span><span class='lbracket'>[</span><span class='symbol'>:path</span><span class='rbracket'>]</span><span class='rparen'>)</span><span class='comma'>,</span>
        <span class='label'>value:</span> <span class='lparen'>(</span><span class='id identifier rubyid_solution'>solution</span><span class='lbracket'>[</span><span class='symbol'>:value</span><span class='rbracket'>]</span> <span class='op'>||</span> <span class='id identifier rubyid_node'>node</span><span class='rparen'>)</span><span class='comma'>,</span>
        <span class='label'>message:</span> <span class='ivar'>@options</span><span class='period'>.</span><span class='id identifier rubyid_fetch'>fetch</span><span class='lparen'>(</span><span class='symbol'>:message</span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>node does not coform to SPARQL component</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span><span class='comma'>,</span>
        <span class='label'>resultSeverity:</span> <span class='id identifier rubyid_options'>options</span><span class='period'>.</span><span class='id identifier rubyid_fetch'>fetch</span><span class='lparen'>(</span><span class='symbol'>:severity</span><span class='rparen'>)</span><span class='comma'>,</span>
        <span class='label'>component:</span> <span class='const'>RDF</span><span class='op'>::</span><span class='const'>Vocab</span><span class='op'>::</span><span class='const'>SHACL</span><span class='period'>.</span><span class='const'>SPARQLConstraintComponent</span><span class='comma'>,</span>
        <span class='label'>depth:</span> <span class='id identifier rubyid_depth'>depth</span><span class='comma'>,</span> <span class='op'>**</span><span class='id identifier rubyid_options'>options</span><span class='rparen'>)</span>
    <span class='kw'>end</span>
  <span class='kw'>end</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
  </div>

</div>

      <div id="footer">
  Generated on Tue Jun  7 22:44:08 2022 by
  <a href="https://yardoc.org" title="Yay! A Ruby Documentation Tool" target="_parent">yard</a>
  0.9.28 (ruby-3.1.2).
</div>

    </div>
  </body>
</html>